name = "pinchpoint"
main = "src/index.js"
compatibility_date = "2025-01-01"
account_id = "704f1ca4f88ce7b89c464af6f5dfb682"

# Maintenance cron only — ping scheduling is handled by DO alarms
[triggers]
crons = ["0 */6 * * *"]

# Durable Object: one per user, handles schedule + alarms
[[durable_objects.bindings]]
name = "USER_SCHEDULE"
class_name = "UserScheduleDO"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["UserScheduleDO"]

# KV: ephemeral connect sessions (5 min TTL)
[[kv_namespaces]]
binding = "KV"
id = "5d9bb168e2344a39bf39753f1ef8a2e7"

# Public vars
[vars]
CLERK_FRONTEND_API = "clerk.pinchpoint.dev"  # Clerk domain — used for JWKS + JWT issuer check
CLERK_PUBLISHABLE_KEY = "pk_live_Y2xlcmsucGluY2hwb2ludC5kZXYk"  # JWT azp claim validation
FRONTEND_URL = "https://pinchpoint.dev"

# Secrets (set via `wrangler secret put`):
# CLERK_SECRET_KEY      — Clerk backend secret key (for JWT verification + Backend API)
# RESEND_API_KEY        — Resend email API key
# PING_SERVICE_URL      — Fly.io ping service URL
# PING_SECRET           — HMAC shared secret for request signing
# ENCRYPTION_KEY        — AES-256 master key for at-rest token encryption (hex, 32 bytes)
# PING_ENCRYPTION_KEY   — AES-256 key for transit encryption DO→ping (hex, 32 bytes)
